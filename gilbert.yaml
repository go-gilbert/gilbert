version: 1.0
vars:
  buildDir: './build'
  version: '0.2.1'
  commit: '{% git log --format=%H -n 1 %}'

mixins:
  platform-build:
    - plugin: build
      description: 'build for {{os}} {{arch}}'
      vars:
        ext: ''
      params:
        outputPath: '{{buildDir}}/gilbert_{{os}}-{{arch}}{{ext}}'
        target:
          os: '{{os}}'
          arch: '{{arch}}'
        variables:
          'main.version': '{{ version }}'
          'main.commit': '{{ commit }}'

tasks:
  build:
  - plugin: build
    description: "Building project"
    params:
      variables:
        'main.version': '{{ version }}'
        'main.commit': '{{ commit }}'
  - if: 'uname -a'
    description: "Show a message only if job runs on UNIX"
    plugin: shell
    params:
      command: 'echo This is UNIX machine'

  release:
  - mixin: platform-build
    vars:
      os: windows
      arch: '386'
      ext: '.exe'
  - mixin: platform-build
    vars:
      os: windows
      arch: 'amd64'
      ext: .exe
  - mixin: platform-build
    vars:
      os: darwin
      arch: 'amd64'
  - mixin: platform-build
    vars:
      os: linux
      arch: 'amd64'
  - mixin: platform-build
    vars:
      os: linux
      arch: '386'